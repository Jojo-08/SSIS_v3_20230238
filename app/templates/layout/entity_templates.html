{%extends 'layout/base.html'%} {% block title %} Students Table {%endblock%} {%
block content %}

<!-- Sortable Table Styles -->
<style>
  .sortable {
    cursor: pointer;
    user-select: none;
    position: relative;
    padding-right: 20px !important;
  }
  .sortable:hover {
    background-color: rgba(0, 0, 0, 0.05);
  }
  .sortable::after {
    content: "⇅";
    position: absolute;
    right: 5px;
    opacity: 0.3;
    font-size: 12px;
  }
  .sortable.asc::after {
    content: "↑";
    opacity: 1;
  }
  .sortable.desc::after {
    content: "↓";
    opacity: 1;
  }
  .search-highlight {
    background-color: #fff3cd;
  }
  /* Force filter dropdowns to open downward */
  #filterCollapse .form-select {
    position: relative;
  }
  #filterCollapse {
    margin-bottom: 1rem;
  }
</style>

<div class="container">
  {% block header1%}
  <h2>Students</h2>
  {%endblock%} {% block paragraph %}
  <p>Manage your students and their Information</p>
  {% endblock %}

  <!-- Filters Section -->
  {% block filters %}{% endblock %}
</div>
<div class="container">
  <div class="container-fluid">
    <!-- Search Input -->
    <div class="d-flex flex-row flex-fill mb-2">
      <div class="col-md-12 d-flex flex-row">
        <div class="input-group d-flex">
          <span class="input-group-text"><i class="bi bi-search"></i></span>
          <input
            class="form-control"
            type="text"
            id="searchInput"
            placeholder="Type to search..."
            aria-label="Search"
          />
          <button
            class="btn btn-outline-secondary"
            type="button"
            id="clearSearch"
          >
            <i class="bi bi-x-lg"></i>
          </button>
        </div>
        <small
          id="searchResultCount"
          class="text-muted"
          style="display: none"
        ></small>
      </div>
    </div>
  </div>

  <div class="container-fluid mt-2">
    <div class="card p-3">
      <div class="container-fluid">
        <div class="row justify-content-between align-items-center">
          <div class="col">
            {% block header2%}
            <h5 class="card-title">Students(#)</h5>
            {% endblock %}
          </div>
          <div class="col-auto">
            <button
              type="button"
              class="btn btn-success"
              data-bs-toggle="modal"
              data-bs-target="#{% block modal_target%}defaultModal{% endblock%}"
            >
              <i class="bi bi-plus-square"></i>
              Add {% block label%}Student {%endblock%}
            </button>
          </div>
        </div>
      </div>
      <table
        class="table mt-2 table-striped text-center align-middle sortable-table"
        id="{% block table_id %} default-id{% endblock%}"
      >
        <thead>
          {% block table_head%}
          <tr>
            <th scope="col">#</th>
            <th scope="col">First</th>
            <th scope="col">Last</th>
            <th scope="col">Handle</th>
            <th scope="col">Actions</th>
          </tr>
          {% endblock %}
        </thead>
        <tbody>
          {%block table_body %}
          <tr>
            <th scope="row">1</th>
            <td>Mark</td>
            <td>Otto</td>
            <td>@mdo</td>
            <td>
              <button class="btn btn-sm btn-success me-2">
                <i class="bi bi-pencil"></i>
              </button>
              <button class="btn btn-sm btn-danger">
                <i class="bi bi-trash"></i>
              </button>
            </td>
          </tr>
          <tr>
            <th scope="row">2</th>
            <td>Jacob</td>
            <td>Thornton</td>
            <td>@fat</td>
          </tr>
          <tr>
            <th scope="row">3</th>
            <td>John</td>
            <td>Doe</td>
            <td>@social</td>
          </tr>
          {% endblock %}
        </tbody>
      </table>

      {% set per_page = per_page|default(20) %} {% set total_pages =
      ((Total|default(0)) / per_page)|round(0, 'ceil')|int %} {% set
      current_page = page|default(1) %} {% set current_sort_by =
      sort_by|default('') %} {% set current_sort_order =
      sort_order|default('asc') %} {% set filter_params = [] %} {% if filters %}
      {% for key, value in filters.items() %} {% if value %} {% set _ =
      filter_params.append('filter_' + key + '=' + value|string) %} {% endif %}
      {% endfor %} {% endif %} {% set filter_string = '&' +
      filter_params|join('&') if filter_params else '' %} {% if total_pages > 1
      %}
      <nav>
        <ul
          class="pagination justify-content-center"
          id="{% block pagination_id%} default-pagination {%endblock%}"
        >
          <!-- Previous Button -->
          <li class="page-item {% if current_page <= 1 %}disabled{% endif %}">
            <a
              class="page-link"
              href="?page={{ current_page - 1 }}&sort_by={{ current_sort_by }}&sort_order={{ current_sort_order }}{{ filter_string }}"
              >Previous</a
            >
          </li>

          <!-- Page Numbers -->
          {% for p in range(1, total_pages + 1) %} {% if p == 1 or p ==
          total_pages or (p >= current_page - 2 and p <= current_page + 2) %}
          <li class="page-item {% if p == current_page %}active{% endif %}">
            <a
              class="page-link"
              href="?page={{ p }}&sort_by={{ current_sort_by }}&sort_order={{ current_sort_order }}{{ filter_string }}"
              >{{ p }}</a
            >
          </li>
          {% elif p == current_page - 3 or p == current_page + 3 %}
          <li class="page-item disabled">
            <span class="page-link">...</span>
          </li>
          {% endif %} {% endfor %}

          <!-- Next Button -->
          <li
            class="page-item {% if current_page >= total_pages %}disabled{% endif %}"
          >
            <a
              class="page-link"
              href="?page={{ current_page + 1 }}&sort_by={{ current_sort_by }}&sort_order={{ current_sort_order }}{{ filter_string }}"
              >Next</a
            >
          </li>
        </ul>
      </nav>
      {% endif %}
    </div>
  </div>
</div>
{%block modals %} {%endblock%}

<!-- Table Utilities (Search & Sort) -->
<script src="{{ url_for('static', filename='js/table-utils.js') }}"></script>

<!-- Fix dropdown direction in filter collapse -->
<script>
  document.addEventListener("DOMContentLoaded", function () {
    // Ensure filter collapse has enough space when opened
    const filterCollapse = document.getElementById("filterCollapse");
    if (filterCollapse) {
      filterCollapse.addEventListener("show.bs.collapse", function () {
        // Scroll to top of filter section to ensure dropdown space
        this.scrollIntoView({ behavior: "smooth", block: "start" });
      });
    }
  });
</script>

{%endblock%}
